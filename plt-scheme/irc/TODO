-*-outline-*-

-- High priority

* bug

at r4401, I ran "./run-bot.ss -v -c '#emacs' -j 1", and my local
dancer-ircd eventually disconnected the bot, saying something about a
"ping timeout".  I wonder if the bot was so busy spamming the channel
with funny quotes that it didn't get around to responding to PING
... if so, that suggests that we ought to prioritize our threads, and
give the PING response higher priority than the quotes.

* Windows

** Test regularly
   I'd have expected that the repl won't work there, since I try to
   use "readline", and yet it seems ok

** "ERROR :Closing Link: fartbot (Invalid username [~#f])" -> prefix (#f #f #f); command "ERROR" params ":Closing Link: fartbot (Invalid username [~#f])" 
  I suspect I can simply set some "username" parameter to something if it's #f

* write our own identd server
  like every other IRC client out there.

* Deal with netsplits, or whatever the hell it is
  ... that makes the bot not work even though /whois says it's still
  there.  Also, what do I do if it connects and the server says that
  the nick is already registered?  (Answer: try again, specifying some
  other nick via the --nick command-line flag.)

** Now that I've registered some nicks on freenode ...
   (namely "rudybot" and "rudebot"; they're "linked"), maybe that'll
   help.  Perhaps it should do something like "/msg nickserv identify
   <password>" when it starts up.  It should thus take a new
   command-line flag for specifying the password.

** Maybe simply detecting them
   ... and then exiting, is better than doing nothing

-- Low priority

* try file-stream-buffer-mode
  ... on current-output-port and current-error-port, as an alternative
  to scattering calls to "flush-output" everywhere

* reset terminal state on abort
  I notice that, when I abort the terminal in which the bot (and, in
  particular, its repl) is running, I need to type "reset" at the
  shell in order to see characters echo.  This is a bug in mzscheme
  itself
  (http://bugs.plt-scheme.org/query/gnatsweb.pl?cmd=view%20audit-trail&database=default&pr=8836),
  but I should at least work around it.

* persistence
  It'd be nice to save stuff to disk.  Currently I save the date of
  the last planet.emacsen.org headline that we spewed ...  But I dunno
  if simply "write"ing an sexpression will suffice for more complex
  data ... it'd be nice to have bindings to Berkeley DB.

* Maybe run svnversion
  to generate the bot's ID string, instead of using the $Id$ keyword.

* Move some stuff into a "tools" subdir
  anything that isn't essential to the actual running of the bot.

* Find some way to deal with exceptions in threads
  e.g., "procedure internal-entries-newer-than: expects 3 arguments,
  given 2 ...".  That procedure application is happening in a thread
  other than the main one, and so rather than the whole app dying, it
  just hangs.  This is annoying during development.

* Convert from strings to bytes
  Wherever possible, change from using "string" procedures to "bytes"
  procedures -- since IRC doesn't specify any character encoding.  As
  things stand now, we're implicitly using UTF-8 everywhere; it'd be
  better for the encoding to be explicit.  That way, eventually I
  could have per-channel encodings.

* maybe periodically see what channels _I'm_ in ...
  and join them if it's not already in them.  Like a little puppy dog.
  This is harder than it sounds, since it's not blindingly clear who
  "I" am -- sometimes my nick changes.  It would probably be best to
  find me by host name, not nick.

* Catch Control-C so that we don't spew an ugly stack trace when we're killed.
  Maybe even do a nice PART and QUIT while we're at it.

* Do the tinyurl thing!!
  I.e., whenever anyone utters a URL (that isn't itself a tinyurl),
  send it to tinyurl, and utter the tiny version.  A public service!
  This is harder than it seems at first; I had some sort of trouble
  with URL quoting.

* movies
** Do buubot's job...
  ... find Ebert reviews of movies.  Use IMDB; find the "external
  reviews" link; find Ebert's name.  (I honestly think this would be
  as reliable as searching on rogerebert.com; that site's design is as
  lame as its content is excellent)

** my del.icio.us "moviestowatchfor" ...
  maybe, somehow, spam ##cinema with one of those.
* jordanb quotes

** Cancelling the thread takes a while
  I.e., I say "shaddap", and it emits a few more quotes before going
  away (at least, if the interval is just a few seconds).  It should
  be immediate.

* emacschannelquotes
  <e1f> offby1: you need to include emacschannelquotes in rudebot
  He means snag stuff from
  http://www.emacswiki.org/cgi-bin/wiki?EmacsChannelQuotes, but I'd
  rather not do that since most of those quotes are multi-line, and
  wouldn't look good if collapsed.

* new commands

** Respond to "version" and "help"
  since people seem to expect those

** "uptime"
  since I'm occasionally curious

** auto shakespeare insults
   I've got scheme code to do that around here somewhere.

* put debug spew someplace where it won't interfere with the REPL
  Like, oh, I don't know, maybe ... a LOG FILE?!?!

* repl commands

I wonder if I should make a new module that contains stuff
specifically for interacting with the bot via the REPL.  It'd be
essentially a full-blown IRC client with a scheme syntax.

** join and part
   so that I can change which channels it's on without restarting it

** planet
   Now that we've got a repl, how about a command which we could
   invoke like (planet 3), which would emit the last 3 headlines.

** privmsg
   since I clearly enjoy putting words in its mouth.  Such a command
   would save a few keystrokes; as it now stands I have to type
   something like

        (put "PRIVMSG ##cinema :\u0001ACTION casually moves in front of offby1\u0001")

   Be nice to abbreviate that to (PRIVMSG/ACTION "casually moves in
   front of offby1")

   Note that the REPL uses readline, and has completion, so the
   rather long identifier PRIVMSG/ACTION wouldn't actually be hard to
   type.

   Note also that this idea suggests that the bot, or at least the
   repl, have the notion of a "current channel", just like any other
   IRC client; and thus there ought to be a command that changes the
   channel.  Also obviously there should be a way to find out what
   channel you're in; I suspect the REPL prompt can easily be made to
   include that.

** cancel a timer
   Say I get bored waiting for it to finish sleeping 3600 seconds to
   download more news from Planet Emacs; I could type a command that
   would cause that "sleep" to exit, and the loop to continue.

** examine a timer
   Or maybe have the timers constantly visible in the repl (it'd be
   nice to have curses support to do this).  So I could watch them
   count down.

* don't restrict "seen" to the current channel

  I.e., if bob speaks in #cats, and someone in #dogs asks "seen bob",
  we should say "bob last spoke, in #cats, at 1:23:45 PM, saying
  "meow"

* truncate output from "seen" command
  because it can be annoyingly long, if the last thing they said was
  annoyingly long.

* 
  <fledermaus> every time jordanb chips in with a "Let's..."
  statement, rudebot should reciprocate.

  Or at least it should squirrel away the quip.

* a "channel" abstraction
  It's uh ... a stream of messages.  Yeah.  Maybe a lazy stream.  Or
  something.  Every time we JOIN we create a new one and save it in a
  list.  The as-yet-unwritten "do-when-channel-idle" would take it as
  an argument.

* planet

I started it up, I think there was already a timestamp file, it didn't
emit any headlines, I typed "rudybot: news" ... and nothing.

My guess is that the async-channel is full of old headlines, and the
thread that feeds the channel is sleeping.  So *some-recent-entries*
has had no chance to be filled.  Perhaps the "news" command should
somehow force the issue ...

* Terminology
  I suspect there is one RFC-1149-ly correct term for what I variously
  call "requester" and "source" (i.e., the guy who sends an IRC
  message), and other terms.  Try to use the same terms that the RFC
  uses, so that someone who's familiar with the RFC, when reading this
  code, will feel right at home.

* General IRC wisdom
  aptitude install dancer-ircd-doc and read.
